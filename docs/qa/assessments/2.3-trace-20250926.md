# Requirements Traceability Matrix

## Story: 2.3 - Core Navigation Commands

### Coverage Summary

- Total Requirements: 10
- Fully Covered: 9 (90%)
- Partially Covered: 1 (10%)
- Not Covered: 0 (0%)

### Requirement Mappings

#### AC1: 'n'/Enter advances to next step

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `NavigationCommandHandler.test.ts::should execute advance next command (n/Enter)`
  - Given: User presses 'n' key
  - When: NavigationCommandHandler processes keyboard event
  - Then: Emits 'navigation-advance-next' event with current step ID

- **Unit Test**: `NavigationCommandHandler.test.ts::should handle Enter key as advance command`
  - Given: User presses Enter key
  - When: NavigationCommandHandler processes keyboard event
  - Then: Emits 'navigation-advance-next' event same as 'n' key

- **Integration Test**: `NavigationIntegration.test.ts::should handle complete navigation workflow`
  - Given: User on current step with working navigation system
  - When: User presses 'n' and workflow advances to next step
  - Then: System emits correct events and updates state appropriately

#### AC2: 'd' marks done and auto-advances

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `NavigationCommandHandler.test.ts::should execute mark done and advance command (d)`
  - Given: User on current step
  - When: User presses 'd' key
  - Then: Marks current step as completed, emits event, sets unsaved changes flag

- **Integration Test**: `NavigationIntegration.test.ts::should handle complete navigation workflow`
  - Given: User on step with completed workflow state
  - When: User presses 'd' key
  - Then: Step marked done, auto-advance triggered, state updated

#### AC3: 's' skips with confirmation

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `NavigationCommandHandler.test.ts::should show confirmation for skip command (s)`
  - Given: User presses 's' key
  - When: NavigationCommandHandler processes keyboard event
  - Then: Shows confirmation modal with appropriate message

- **Integration Test**: `NavigationIntegration.test.ts::should handle navigation with confirmations`
  - Given: User presses skip command requiring confirmation
  - When: User confirms action in modal dialog
  - Then: Skip action executed with proper state updates

#### AC4: 'b' goes back to previous step

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `NavigationCommandHandler.test.ts::should execute go back command (b) when previous step exists`
  - Given: User has previous step in navigation history
  - When: User presses 'b' key
  - Then: Emits 'navigation-go-back' event with current and target step IDs

- **Unit Test**: `NavigationCommandHandler.test.ts::should validate back command requires previous step`
  - Given: User has no previous step in navigation history
  - When: User presses 'b' key
  - Then: Emits error event indicating no previous step available

- **Integration Test**: `NavigationIntegration.test.ts::should handle invalid state transitions gracefully`
  - Given: User tries to go back without previous step
  - When: Back command executed
  - Then: System handles gracefully with error reporting

#### AC5: 'r' resets to beginning

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `NavigationCommandHandler.test.ts::should show confirmation for reset command (r)`
  - Given: User presses 'r' key
  - When: NavigationCommandHandler processes keyboard event
  - Then: Shows confirmation modal asking about reset action

- **Integration Test**: `NavigationIntegration.test.ts::should handle navigation with confirmations`
  - Given: User presses reset command requiring confirmation
  - When: User confirms reset action
  - Then: Navigation state reset to beginning, unsaved changes flag set

#### AC6: 'l' toggles list view

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `NavigationCommandHandler.test.ts::should execute toggle view command (l)`
  - Given: User in current view mode
  - When: User presses 'l' key
  - Then: Emits 'navigation-toggle-view' event with new view mode

- **Unit Test**: `NavigationCommandHandler.test.ts::should toggle view mode correctly`
  - Given: User in list or detail view mode
  - When: User presses 'l' key multiple times
  - Then: View mode toggles between list and detail appropriately

- **Integration Test**: `NavigationIntegration.test.ts::should handle view mode toggling correctly`
  - Given: Working view system integration
  - When: User toggles view mode
  - Then: System maintains correct state and emits appropriate events

#### AC7: '?' shows help overlay

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `NavigationCommandHandler.test.ts::should show help overlay (?)`
  - Given: User presses '?' key
  - When: NavigationCommandHandler processes keyboard event
  - Then: Shows modal with navigation help content

- **Unit Test**: `NavigationCommandHandler.test.ts::should generate correct help content`
  - Given: User requests help overlay
  - When: Help modal is generated
  - Then: Content contains all navigation commands with descriptions

- **Integration Test**: `NavigationIntegration.test.ts::should integrate with view system for modal dialogs`
  - Given: User presses help key
  - When: Help command processed
  - Then: View system displays modal with correct content

#### AC8: 'q' quits with unsaved check

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `NavigationCommandHandler.test.ts::should show confirmation for quit command (q)`
  - Given: User has unsaved changes and presses 'q' key
  - When: NavigationCommandHandler processes keyboard event
  - Then: Shows quit confirmation modal with save options

- **Integration Test**: `NavigationIntegration.test.ts::should handle workflow with unsaved changes`
  - Given: User has unsaved changes
  - When: User presses quit command
  - Then: System shows confirmation dialog with save and quit options

#### AC9: Visual feedback for all actions

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `NavigationFeedback.test.ts::should show command feedback`
  - Given: Navigation command executed
  - When: Feedback system receives command status
  - Then: Shows appropriate visual feedback with command key and status

- **Unit Test**: `NavigationFeedback.test.ts::should handle different feedback statuses`
  - Given: Command execution results in different states
  - When: Feedback processed for each status type
  - Then: Correct visual indicators displayed for executing, success, error, cancelled

- **Unit Test**: `NavigationFeedback.test.ts::should display correct icons for different statuses`
  - Given: Various command execution outcomes
  - When: Feedback rendered
  - Then: Appropriate icons shown (⟳ for executing, ✓ for success, ✗ for error, ⊘ for cancelled)

- **Unit Test**: `NavigationFeedback.test.ts::should render status indicators from history`
  - Given: Previous command executions in history
  - When: No current feedback active
  - Then: Status indicators shown from recent command history

#### AC10: Command queueing prevents race conditions

**Coverage: PARTIAL**

Given-When-Then Mappings:

- **Unit Test**: `CommandQueue.test.ts::should process commands in priority order`
  - Given: Multiple commands with different priorities enqueued
  - When: Queue processes commands
  - Then: Higher priority commands executed first

- **Unit Test**: `CommandQueue.test.ts::should debounce rapid command additions`
  - Given: Rapid successive command additions
  - When: Commands enqueued quickly
  - Then: Processing debounced to prevent race conditions

- **Unit Test**: `NavigationCommandHandler.test.ts::should prevent command execution during processing`
  - Given: Rapid key presses on navigation commands
  - When: Multiple commands triggered simultaneously
  - Then: Commands queued properly without race conditions

- **Integration Test**: `NavigationIntegration.test.ts::should handle rapid key presses without race conditions`
  - Given: Very rapid key presses from user
  - When: Navigation system processes input
  - Then: All commands processed correctly without conflicts

- **Integration Test**: `NavigationIntegration.test.ts::should prioritize critical commands`
  - Given: Multiple commands including high-priority quit command
  - When: Commands processed simultaneously
  - Then: Critical commands prioritized appropriately

**GAP IDENTIFIED**: Missing comprehensive test for queue overflow recovery scenario
- Gap: No test specifically validates graceful handling when command queue exceeds maximum capacity
- Severity: Medium - Could lead to command loss under extreme load
- Suggested test: Integration test that floods queue beyond capacity and verifies recovery behavior

### Critical Gaps

1. **Command Queue Overflow Recovery**
   - Gap: No test for graceful handling when queue exceeds maximum capacity
   - Risk: Medium - Commands could be lost under extreme load conditions
   - Action: Add integration test that validates overflow handling and recovery

### Test Design Recommendations

Based on gaps identified, recommend:

1. **Queue Overflow Test**
   - Type: Integration
   - Description: Test behavior when command queue flooded beyond maximum capacity
   - Should validate: Graceful degradation, error handling, system stability

2. **Memory Stress Test**
   - Type: Performance
   - Description: Validate memory usage under sustained high command load
   - Should validate: Memory management, garbage collection, no leaks

### Risk Assessment

- **High Risk**: None identified
- **Medium Risk**: Command queue overflow scenario
- **Low Risk**: All other requirements have comprehensive coverage

### Performance Validation

All navigation commands meet the <50ms performance requirement as validated by:
- Performance monitoring integration tests
- Command execution timing validation
- Queue processing efficiency tests