# Requirements Traceability Matrix

## Story: 1.12 - StrykerJS Mutation Testing Infrastructure

### Coverage Summary

- Total Requirements: 8
- Fully Covered: 6 (75%)
- Partially Covered: 2 (25%)
- Not Covered: 0 (0%)

### Requirement Mappings

#### AC1: StrykerJS configured with command runner to execute Bun tests directly

**Coverage: FULL**

Given-When-Then Mappings:

- **Configuration Implementation**: `stryker.conf.js:9-14`
  - Given: StrykerJS core package @stryker-mutator/core@9.1.0 installed
  - When: Configuration sets testRunner: 'command' with commandRunner.command: 'STRYKER_MUTATOR_RUNNER=true bun test --test-name-pattern="^(?!.*Integration)"'
  - Then: Bun test runner executes directly without requiring a StrykerJS plugin

- **Integration Validation**: Dev Agent Record lines 343-347
  - Given: Test file packages/core/src/validation.ts with unit tests
  - When: Executing 'bunx stryker run' command
  - Then: Successfully generates 69 mutants, runs tests, achieves 62.32% mutation score (43 killed, 26 survived)

#### AC2: Mutation score threshold set to 85% minimum

**Coverage: FULL**

Given-When-Then Mappings:

- **Threshold Configuration**: `stryker.conf.js:35-40`
  - Given: StrykerJS thresholds configuration object
  - When: Setting thresholds: { high: 95, low: 90, break: 85 }
  - Then: Process exits with non-zero code if mutation score < 85%

- **CI Enforcement**: `.github/workflows/mutation.yml:144-160`
  - Given: Main branch push with completed mutation testing
  - When: Parsing mutation-report.json and score < 85%
  - Then: Shell script exits with code 1, failing the GitHub Actions job

#### AC3: StrykerJS integrated into CI/CD pipeline with failure on threshold breach

**Coverage: PARTIAL**

Given-When-Then Mappings:

- **PR Incremental Testing**: `.github/workflows/mutation.yml:50-57`
  - Given: Pull request event triggers workflow
  - When: Running 'bunx stryker run --incremental --reporters html,json,progress'
  - Then: Incremental mutation testing runs with continue-on-error: true (non-blocking)

- **Main Branch Full Testing**: `.github/workflows/mutation.yml:60-66`
  - Given: Push to main branch
  - When: Running 'bunx stryker run --reporters dashboard,html,json'
  - Then: Full mutation testing with dashboard upload attempt and threshold enforcement

- **Threshold Enforcement**: `.github/workflows/mutation.yml:144-160`
  - Given: Main branch with mutation-report.json containing mutationScore field
  - When: Score evaluated using jq and bc for comparison < 85
  - Then: Script exits 1, failing the job and preventing merge

**Gap**: Dashboard reporter will fail without STRYKER_DASHBOARD_API_TOKEN (Task 6 incomplete)

#### AC4: All default mutators enabled for comprehensive mutation coverage

**Coverage: FULL**

Given-When-Then Mappings:

- **Default Mutator Configuration**: `stryker.conf.js:110`
  - Given: StrykerJS 9.1.0 with no mutator configuration (comment confirms mutator.name deprecated)
  - When: No mutator exclusions or disableTypeChecks specified
  - Then: All JavaScript/TypeScript mutators active by default

- **Mutator Validation**: Dev Agent Record mutation results
  - Given: Mutation testing on validation.ts
  - When: Analyzing 69 generated mutants
  - Then: Multiple mutation types observed including:
    - String Literal mutations
    - Conditional Expression mutations
    - Boolean Literal mutations
    - Arithmetic Operator mutations
    - Logical Operator mutations

#### AC5: HTML reporter configured for visual mutation reports

**Coverage: FULL**

Given-When-Then Mappings:

- **HTML Reporter Configuration**: `stryker.conf.js:43-48`
  - Given: reporters array includes 'html' and htmlReporter configuration block
  - When: Mutation testing completes
  - Then: HTML report generated at fileName: 'reports/mutation/index.html'

- **CI Artifact Upload**: `.github/workflows/mutation.yml:68-75`
  - Given: Mutation testing job completes (if: always())
  - When: actions/upload-artifact@v3 executes
  - Then: HTML report uploaded as 'mutation-report' artifact with 30-day retention

#### AC6: Incremental testing enabled for faster PR validation

**Coverage: FULL**

Given-When-Then Mappings:

- **Incremental Configuration**: `stryker.conf.js:55-61`
  - Given: incremental: true with incrementalFile: '.stryker-tmp/incremental.json'
  - When: Running mutation tests with --incremental flag
  - Then: Only mutates changed files since last run, using cached results for unchanged code

- **PR Workflow Optimization**: `.github/workflows/mutation.yml:50-57`
  - Given: github.event_name == 'pull_request'
  - When: Executing 'bunx stryker run --incremental'
  - Then: Faster validation using incremental mode with continue-on-error: true

- **Cache Management**: `.github/workflows/mutation.yml:39-47`
  - Given: GitHub Actions cache configuration
  - When: Restoring/saving .stryker-tmp directory
  - Then: Incremental data persists across workflow runs

#### AC7: Dashboard integration for tracking mutation score trends

**Coverage: PARTIAL**

Given-When-Then Mappings:

- **Dashboard Configuration**: `stryker.conf.js:101-108`
  - Given: Dashboard block with project: 'github.com/eduardomenoncello/checklist'
  - When: STRYKER_DASHBOARD_API_TOKEN environment variable present
  - Then: Uploads to baseUrl: 'https://dashboard.stryker-mutator.io/api/reports'

- **CI Token Injection**: `.github/workflows/mutation.yml:53,63`
  - Given: GitHub secret STRYKER_DASHBOARD_API_TOKEN configured
  - When: Environment variable set in mutation testing steps
  - Then: Dashboard reporter authenticates and uploads results

**Gaps** (Task 6 incomplete):
- Project registration on dashboard.stryker-mutator.io not completed
- STRYKER_DASHBOARD_API_TOKEN not stored in GitHub Secrets
- Dashboard webhooks for score degradation notifications not configured
- Mutation score badge not added to README

#### AC8: Parallel execution configured for optimal performance

**Coverage: FULL**

Given-When-Then Mappings:

- **Concurrency Configuration**: `stryker.conf.js:64-65`
  - Given: concurrency: 4 and maxTestRunnerReuse: 0 settings
  - When: Mutation testing executes
  - Then: Runs 4 parallel test runners without reuse (Bun compatibility)

- **Performance Optimizations**: `stryker.conf.js:67-86`
  - Given: Performance-critical settings configured
  - When: Running with timeoutMS: 60000, timeoutFactor: 1.5, coverageAnalysis: 'perTest'
  - Then: Optimized execution with per-test coverage analysis for incremental mode

- **CI Timeout Protection**: `.github/workflows/mutation.yml:22`
  - Given: GitHub Actions job configuration
  - When: timeout-minutes: 30 set on mutation-test job
  - Then: Prevents runaway processes from consuming CI resources

### Critical Gaps

1. **Dashboard Integration (AC7)**
   - Gap: Dashboard API token not configured
   - Risk: Medium - Cannot track mutation score trends
   - Action: Complete Task 6 subtasks for dashboard setup

2. **Test Coverage Improvements (Task 4)**
   - Gap: Subtasks for improving module test coverage incomplete
   - Risk: Medium - May not achieve 85% threshold consistently
   - Action: Strengthen test assertions per module targets

### Test Design Recommendations

Based on gaps identified, recommend:

1. **Complete Dashboard Setup**
   - Register project on dashboard
   - Store API token as GitHub secret
   - Test dashboard reporting in CI

2. **Module Test Improvements**
   - Core Module: Target 90% mutation score
   - State Management: Target 85% mutation score
   - CLI Module: Target 85% mutation score
   - Workflow Engine: Target 95% mutation score

3. **CI/CD Enhancements**
   - Verify threshold enforcement works correctly
   - Test incremental mode caching
   - Validate PR comment functionality

### Risk Assessment

- **Low Risk**: Core configuration and reporters (AC1, 2, 4, 5, 6, 8) fully covered
- **Medium Risk**: Dashboard integration incomplete (AC7)
- **Medium Risk**: Some CI integration features untested (AC3 partial)

### Test Environment Considerations

Special handling implemented for mutation testing environment:
- STRYKER_MUTATOR_RUNNER environment variable detection
- Tests skip problematic scenarios when running in mutation sandbox
- Documented in affected test files (setup-validation.test.ts, performance-budget.test.ts)

### Validation Evidence

From Dev Agent Record:
- StrykerJS 9.1.0 successfully installed and configured
- Mutation testing validated with 62.32% score on validation.ts
- CI/CD workflow created and functional
- HTML and JSON reporters generating correctly
- Incremental mode operational with cache management