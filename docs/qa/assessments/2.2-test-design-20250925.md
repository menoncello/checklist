# Test Design: Story 2.2

Date: 2025-09-25
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 48
- Unit tests: 23 (48%)
- Integration tests: 17 (35%)
- E2E tests: 8 (17%)
- Priority distribution: P0: 15, P1: 20, P2: 13

## Test Scenarios by Acceptance Criteria

### AC1: Detail panel displays current step prominently

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.2-UNIT-001 | Unit | P0 | Panel initializes with correct dimensions | Pure component logic |
| 2.2-UNIT-002 | Unit | P0 | Panel displays step title correctly | Text rendering validation |
| 2.2-INT-001 | Integration | P0 | Panel integrates with ViewSystem | Component registration flow |
| 2.2-E2E-001 | E2E | P1 | User sees current step in panel | Critical user journey |

### AC2: Markdown rendering for bold, italic, code blocks

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.2-UNIT-003 | Unit | P0 | Parse **bold** markdown syntax | Pure parsing logic |
| 2.2-UNIT-004 | Unit | P0 | Parse *italic* markdown syntax | Pure parsing logic |
| 2.2-UNIT-005 | Unit | P0 | Parse `code` inline blocks | Pure parsing logic |
| 2.2-UNIT-006 | Unit | P0 | Parse ```code``` fenced blocks | Pure parsing logic |
| 2.2-UNIT-007 | Unit | P1 | Handle nested markdown (bold+italic) | Complex parsing edge case |
| 2.2-UNIT-008 | Unit | P2 | Handle malformed markdown gracefully | Error handling |
| 2.2-INT-002 | Integration | P0 | Render bold text with ANSI codes | Terminal output validation |
| 2.2-INT-003 | Integration | P0 | Render italic text with ANSI codes | Terminal output validation |
| 2.2-INT-004 | Integration | P0 | Render code blocks with background | Terminal styling |
| 2.2-E2E-002 | E2E | P1 | User sees formatted markdown in panel | Visual validation |

### AC3: Commands shown with Claude/Bash indicators

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.2-UNIT-009 | Unit | P0 | Detect Claude command type | Type classification logic |
| 2.2-UNIT-010 | Unit | P0 | Detect Bash command type | Type classification logic |
| 2.2-UNIT-011 | Unit | P1 | Detect internal command type | Type classification logic |
| 2.2-INT-005 | Integration | P0 | Render Claude indicator with icon | UI component rendering |
| 2.2-INT-006 | Integration | P0 | Render Bash indicator with icon | UI component rendering |
| 2.2-INT-007 | Integration | P1 | Apply correct colors per command type | Visual differentiation |

### AC4: Variables highlighted in different color

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.2-UNIT-012 | Unit | P1 | Parse {{variable}} pattern | Pattern matching logic |
| 2.2-UNIT-013 | Unit | P1 | Parse $VAR pattern | Pattern matching logic |
| 2.2-UNIT-014 | Unit | P2 | Parse ${VAR} pattern | Extended pattern support |
| 2.2-INT-008 | Integration | P1 | Render variables with distinct color | Terminal color application |
| 2.2-INT-009 | Integration | P2 | Variables stand out in markdown | Visual hierarchy validation |

### AC5: Panel updates immediately on selection change

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.2-UNIT-015 | Unit | P0 | State update triggers render | Event handling logic |
| 2.2-INT-010 | Integration | P0 | Panel updates within 50ms | Performance requirement |
| 2.2-INT-011 | Integration | P0 | No flicker during updates | Visual stability |
| 2.2-PERF-001 | Performance | P0 | Measure update latency < 50ms | SLA validation |
| 2.2-E2E-003 | E2E | P1 | User navigates and sees instant updates | User experience validation |

### AC6: Long content scrollable with maintained formatting

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.2-UNIT-016 | Unit | P1 | Calculate viewport boundaries | Scroll math logic |
| 2.2-UNIT-017 | Unit | P1 | Track scroll position state | State management |
| 2.2-INT-012 | Integration | P1 | Arrow keys scroll content | Input handling |
| 2.2-INT-013 | Integration | P1 | Formatting preserved during scroll | Render consistency |
| 2.2-INT-014 | Integration | P2 | Show scroll indicators | UI feedback |
| 2.2-E2E-004 | E2E | P1 | User scrolls through long content | Navigation validation |

### AC7: Copy instruction at bottom of panel

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.2-UNIT-018 | Unit | P2 | Footer text displays correctly | Text rendering |
| 2.2-INT-015 | Integration | P1 | Clipboard integration works | External library integration |
| 2.2-INT-016 | Integration | P2 | Copy confirmation feedback shown | User feedback |
| 2.2-E2E-005 | E2E | P2 | User copies content successfully | Feature validation |

### AC8: Syntax highlighting for code blocks

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.2-UNIT-019 | Unit | P1 | Detect language from code fence | Language detection logic |
| 2.2-UNIT-020 | Unit | P1 | Apply syntax tokens for bash | Tokenization logic |
| 2.2-UNIT-021 | Unit | P1 | Apply syntax tokens for typescript | Tokenization logic |
| 2.2-UNIT-022 | Unit | P2 | Apply syntax tokens for yaml | Tokenization logic |
| 2.2-INT-017 | Integration | P1 | Render highlighted code with colors | Terminal color output |
| 2.2-PERF-002 | Performance | P2 | Syntax highlighting < 10ms | Performance validation |

### AC9: Links displayed (but not clickable in TUI)

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.2-UNIT-023 | Unit | P2 | Parse markdown link syntax | Link parsing logic |
| 2.2-E2E-006 | E2E | P2 | User sees links with URL in parentheses | Visual validation |

## Performance Test Scenarios

| ID | Test | Target | Priority |
|----|------|--------|----------|
| 2.2-PERF-001 | Panel update latency | < 50ms | P0 |
| 2.2-PERF-002 | Syntax highlighting overhead | < 10ms | P2 |
| 2.2-PERF-003 | Memory usage with large content | < 10MB growth | P1 |
| 2.2-PERF-004 | Render 1000 lines of markdown | < 100ms | P1 |
| 2.2-PERF-005 | Cache hit ratio | > 90% | P2 |

## Cross-Terminal Compatibility Tests

| ID | Terminal | Test | Priority |
|----|----------|------|----------|
| 2.2-TERM-001 | Terminal.app | All ANSI features work | P0 |
| 2.2-TERM-002 | iTerm2 | All ANSI features work | P0 |
| 2.2-TERM-003 | Alacritty | All ANSI features work | P0 |
| 2.2-TERM-004 | Windows Terminal | All ANSI features work | P0 |
| 2.2-TERM-005 | Basic terminal | Graceful degradation | P1 |

## Risk Coverage

### High Risk Mitigations

- **PERF-001** (Panel performance): Covered by 2.2-INT-010, 2.2-PERF-001
- **TECH-001** (Markdown complexity): Covered by all UNIT markdown tests
- **TECH-002** (Terminal compatibility): Covered by TERM test suite

### Medium Risk Mitigations

- **PERF-002** (Memory leaks): Covered by 2.2-PERF-003
- **TECH-003** (ViewSystem conflicts): Covered by 2.2-INT-001
- **TECH-004** (Scroll bugs): Covered by scroll test scenarios

## Recommended Execution Order

1. **P0 Unit tests** (fail fast on logic errors)
   - Markdown parsing (2.2-UNIT-003 to 006)
   - Panel initialization (2.2-UNIT-001, 002)
   - Command detection (2.2-UNIT-009, 010)

2. **P0 Integration tests**
   - ViewSystem integration (2.2-INT-001)
   - Panel updates (2.2-INT-010, 011)
   - Markdown rendering (2.2-INT-002 to 004)

3. **P0 Performance tests**
   - Update latency (2.2-PERF-001)

4. **P0 Terminal tests**
   - Cross-terminal validation (2.2-TERM-001 to 004)

5. **P1 tests** in sequence

6. **P2 tests** as time permits

## Test Data Requirements

### Markdown Test Fixtures
- Simple text
- Bold/italic/code combinations
- Nested markdown elements
- Long documents (1000+ lines)
- Malformed markdown
- Unicode content
- Code blocks in multiple languages

### Command Test Data
- Claude commands with various formats
- Bash commands with pipes and redirects
- Internal commands
- Mixed command types

### Variable Patterns
- {{template}} variables
- $SHELL variables
- ${COMPLEX} variables
- Nested variables

## Coverage Verification

- [x] AC1: Panel display - 4 tests
- [x] AC2: Markdown rendering - 11 tests
- [x] AC3: Command indicators - 6 tests
- [x] AC4: Variable highlighting - 5 tests
- [x] AC5: Immediate updates - 5 tests
- [x] AC6: Scrolling - 6 tests
- [x] AC7: Copy instruction - 4 tests
- [x] AC8: Syntax highlighting - 6 tests
- [x] AC9: Link display - 2 tests

All acceptance criteria have comprehensive test coverage with no gaps identified.