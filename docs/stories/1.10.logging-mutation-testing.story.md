# Story 1.10: Logging and Mutation Testing Infrastructure

## Status
Draft

## Story
**As a** developer,  
**I want** Pino logging integrated throughout the application with structured logging AND StrykerJS configured for mutation testing,  
**So that** we have production-ready logging and high-quality test coverage validation.

## Acceptance Criteria
1. Pino logger configured with default log levels (debug, info, warn, error, fatal)
2. Structured JSON output format for all log entries
3. Log rotation implemented with configurable file size and retention policies  
4. File output configured with separate files for different log levels
5. Support for 3rd party logging services integration (e.g., Datadog, Splunk, CloudWatch)
6. Debug library completely replaced with Pino throughout the codebase
7. StrykerJS configured to run mutation testing on all unit test files
8. Mutation score threshold set to 85% minimum
9. StrykerJS integrated into CI/CD pipeline with failure on threshold breach
10. All default mutators enabled for comprehensive mutation coverage
11. Performance: Logging overhead must not exceed 5ms per operation
12. All log entries include contextual metadata (timestamp, module, trace ID)

## Tasks / Subtasks
- [ ] **Task 1: Setup Pino Logger Infrastructure** (AC: 1, 2, 11, 12)
  - [ ] Install Pino and required dependencies (`pino`, `pino-pretty`, `pino-roll`)
  - [ ] Create logger factory in `packages/core/src/utils/logger.ts`
  - [ ] Configure default log levels and JSON formatting
  - [ ] Implement context injection for trace IDs and module names
  - [ ] Create type definitions for logger interface

- [ ] **Task 2: Implement Log Rotation and File Output** (AC: 3, 4)
  - [ ] Configure pino-roll for log rotation with size and time-based policies
  - [ ] Setup separate file streams for different log levels
  - [ ] Implement log directory structure (`.logs/info/`, `.logs/error/`, etc.)
  - [ ] Add configuration for retention policies in config file
  - [ ] Create cleanup task for old log files

- [ ] **Task 3: Add 3rd Party Service Integration** (AC: 5)
  - [ ] Create abstract transport interface for external services
  - [ ] Implement plugin system for service adapters
  - [ ] Add configuration schema for service credentials
  - [ ] Create example integration for at least one service
  - [ ] Document integration process for additional services

- [ ] **Task 4: Replace Debug Library with Pino** (AC: 6)
  - [ ] Audit all files using Debug library
  - [ ] Create migration script to convert Debug calls to Pino
  - [ ] Update all import statements from 'debug' to new logger
  - [ ] Remove Debug library from dependencies
  - [ ] Update environment variable documentation (DEBUG → LOG_LEVEL)

- [ ] **Task 5: Setup StrykerJS Mutation Testing** (AC: 7, 10)
  - [ ] Install StrykerJS and required plugins (`@stryker-mutator/core`, `@stryker-mutator/typescript-checker`, `@stryker-mutator/bun-runner`)
  - [ ] Create `stryker.conf.js` configuration file
  - [ ] Configure to target all `*.test.ts` files
  - [ ] Enable all default mutators
  - [ ] Setup HTML reporter for local development

- [ ] **Task 6: Configure Mutation Score Threshold** (AC: 8)
  - [ ] Set threshold configuration to 85% in stryker.conf.js
  - [ ] Configure break-on-threshold behavior
  - [ ] Add score reporting to console output
  - [ ] Create baseline mutation score report

- [ ] **Task 7: Improve Test Coverage for Mutation Testing** (AC: 8)
  - [ ] Run initial StrykerJS analysis to identify surviving mutants
  - [ ] Analyze mutation report to find gaps in test assertions
  - [ ] Create new test cases to kill surviving mutants
  - [ ] Strengthen existing tests with additional assertions
  - [ ] Focus on boundary conditions and edge cases
  - [ ] Add tests for error handling paths
  - [ ] Ensure all conditional branches are tested

- [ ] **Task 8: Integrate StrykerJS with CI/CD** (AC: 9)
  - [ ] Add mutation testing step to GitHub Actions workflow
  - [ ] Configure job to fail if threshold not met
  - [ ] Setup mutation score badge for README
  - [ ] Add mutation report artifacts to CI output
  - [ ] Configure incremental mutation testing for PRs

- [ ] **Task 9: Performance Testing and Documentation** (AC: 11)
  - [ ] Create benchmark tests for logging overhead
  - [ ] Validate <5ms per log operation requirement
  - [ ] Document logger usage patterns and best practices
  - [ ] Create migration guide from Debug to Pino
  - [ ] Update developer documentation with mutation testing workflow

## Dev Notes

### Testing Standards
Based on `docs/architecture/testing-strategy-complete-with-all-testing-utilities.md`:
- Test files location: `*.test.ts` alongside source files
- Use Bun Test as the test runner
- Tests must follow the TestDataFactory pattern for consistency
- Visual regression testing available via VisualRegressionTester class
- Flaky test detection implemented via FlakyTestDetector

### Current Logging Setup
From `docs/architecture/tech-stack.md`:
- Currently using Debug library (4.3.x) for development logging
- Debug provides lightweight logging with namespaces
- Must maintain namespace compatibility during migration

### Coding Standards Compliance
From `docs/architecture/coding-standards.md`:
- ESLint rule `'no-console': 'warn'` - must use logger instead
- Debug logging must use namespaced patterns: `'checklist:module:component'`
- All async operations must include trace IDs for debugging
- Resource cleanup must be implemented for file handles

### Performance Requirements
From Epic 1 Story 1.1:
- Overall performance budget: <50ms startup, <50MB memory
- Logging must not significantly impact these budgets
- Consider lazy initialization for file streams

### Monorepo Structure
- Logger utility goes in `packages/core/src/utils/`
- Each package can import from `@checklist/core`
- Maintain package boundaries (CLI/TUI → Core only)

### StrykerJS Integration Notes
From `docs/architecture/tech-stack.md`:
- StrykerJS version 8.2.x already listed in tech stack
- Purpose: "Test quality validation" and "Ensures tests catch real bugs"
- Must integrate with existing Bun Test runner

### CI/CD Integration
- GitHub Actions used for CI/CD (latest version)
- Multi-platform builds must be supported
- Mutation testing should run after unit tests pass

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-08 | 1.0 | Initial story creation | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
(To be populated by development agent)

### Debug Log References
(To be populated by development agent)

### Completion Notes List
(To be populated by development agent)

### File List
(To be populated by development agent)

## QA Results
(To be populated by QA agent)